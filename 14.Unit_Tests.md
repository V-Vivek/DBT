# Unit Tests in dbt

Unit tests in dbt are used to validate the logic of your SQL models by checking that specific inputs produce expected outputs. While dbt natively supports data tests (assertions on data in your warehouse), unit testing in the traditional sense (isolated logic checks) is achieved using packages like [`dbt-unit-testing`](https://github.com/EqualExperts/dbt-unit-testing).

## Why Unit Test in dbt?

- **Validate business logic**: Ensure your transformations work as intended.
- **Catch regressions**: Prevent changes from breaking existing logic.
- **Improve confidence**: Make refactoring safer and faster.

## How to Implement Unit Tests

1. **Install a Unit Testing Package**  
    Add `dbt-unit-testing` to your `packages.yml`:
    ```yaml
    packages:
      - package: EqualExperts/dbt_unit_testing
         version: [">=0.4.0"]
    ```

2. **Write Unit Tests**  
    Create test YAML files (e.g., `tests/unit/test_my_model.yml`) specifying:
    - The model to test
    - Input data (fixtures)
    - Expected output

    Example:
    ```yaml
    version: 2
    unit_tests:
        - name: test_my_model_adds_10
            model: ref('my_model')
            given:
                - input: ref('my_source')
                    rows:
                        - id: 1
                            value: 5
                        - id: 2
                            value: 15
            expect:
                rows:
                    - id: 1
                        result: 15
                    - id: 2
                        result: 25
    ```
    In this example, the unit test checks that `my_model` adds 10 to the `value` column from `my_source` and outputs it as `result`.


3. **Run Unit Tests**  
    Use the CLI:
    ```
    dbt test --store-failures
    dbt run-operation unit_test
    ```

## Best Practices

- Keep tests small and focused.
- Use meaningful input and expected output.
- Run tests regularly in CI/CD pipelines.

## References

- [dbt-unit-testing documentation](https://github.com/EqualExperts/dbt-unit-testing)
- [dbt Testing Overview](https://docs.getdbt.com/docs/build/tests)
