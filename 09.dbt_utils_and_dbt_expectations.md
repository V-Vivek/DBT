# dbt_utils and dbt_expectations Packages

## Overview

**dbt_utils** and **dbt_expectations** are popular dbt packages that extend dbt's core functionality. They provide macros and tests to simplify data transformations and improve data quality.

---

## dbt_utils

`dbt_utils` offers a collection of generic macros for common data engineering tasks.

### Commonly Used Functions

- **surrogate_key**: Generates a unique key by hashing multiple columns.
    ```sql
    {{ dbt_utils.surrogate_key(['col1', 'col2']) }}
    ```

- **star**: Selects all columns from a table, with options to exclude or rename.
    ```sql
    {{ dbt_utils.star(from=ref('my_table'), except=['unwanted_column']) }}
    ```

- **date_spine**: Creates a date or timestamp series between two dates.
    ```sql
    {{ dbt_utils.date_spine(
            datepart="day",
            start_date="cast('2023-01-01' as date)",
            end_date="cast('2023-12-31' as date)"
    ) }}
    ```

- **get_column_values**: Returns a list of distinct values from a column.
    ```sql
    {{ dbt_utils.get_column_values(table=ref('my_table'), column='status') }}
    ```

---

## dbt_expectations

`dbt_expectations` provides tests inspired by Great Expectations, allowing expressive data quality checks.

### Commonly Used Tests

- **expect_column_values_to_be_in_set**: Checks if column values are within a specified set.
    ```yaml
    tests:
        - dbt_expectations.expect_column_values_to_be_in_set:
                column: status
                value_set: ['active', 'inactive']
    ```

- **expect_table_row_count_to_be_between**: Ensures row count falls within a range.
    ```yaml
    tests:
        - dbt_expectations.expect_table_row_count_to_be_between:
                min_value: 100
                max_value: 1000
    ```

- **expect_column_values_to_not_be_null**: Asserts no nulls in a column.
    ```yaml
    tests:
        - dbt_expectations.expect_column_values_to_not_be_null:
                column: user_id
    ```

---

## Summary

- **dbt_utils**: Utility macros for data transformation.
- **dbt_expectations**: Advanced, configurable data tests.

Both packages help streamline dbt projects and enforce data quality.